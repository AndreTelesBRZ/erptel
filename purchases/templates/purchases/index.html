{% extends 'core/base.html' %}

{% block title %}Compras{% endblock %}
{% block hero_title %}Compras{% endblock %}
{% block hero_subtitle %}Acompanhe pedidos de compra e recebimento de mercadorias{% endblock %}
{% block hero_meta %}
  <div class="quick-stats">
    <span class="chip"><span class="icon" data-lucide="shopping-cart"></span> {{ orders|length }} pedidos</span>
    <span class="chip"><span class="icon" data-lucide="wallet"></span> Total R$ {{ total_amount|floatformat:2 }}</span>
  </div>
{% endblock %}
{% block hero_actions %}
  <a class="button is-primary" href="javascript:void(0)" disabled>Novo pedido (em breve)</a>
{% endblock %}

{% block content %}
  <form method="get" class="surface filters-panel" data-aos="fade-up">
    <div class="filters-grid">
      <div>
        <label class="small text-muted" for="status-filter">Filtrar por status</label>
        <div class="field">
          <div class="select is-fullwidth">
            <select id="status-filter" name="status" onchange="this.form.submit()">
              <option value="">Todos</option>
              {% for value, label in status_choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
      <div class="filter-controls">
        <div class="field-group">
          <div class="control">
            <button class="button is-secondary" type="submit">Aplicar</button>
          </div>
          <div class="control">
            <a class="button is-secondary" href="{% url 'purchases:index' %}">Limpar</a>
          </div>
        </div>
      </div>
    </div>
  </form>

  <div class="box data-card" data-aos="fade-up" data-aos-delay="60">
    <header>
      <div>
        <h2 style="margin:0">Pedidos de compra</h2>
        <p class="small text-muted">Visualização rápida das solicitações mais recentes.</p>
      </div>
      <div class="buttons">
        <a class="button is-secondary" href="#" onclick="return false;">Exportar (em breve)</a>
      </div>
    </header>
    <table class="table is-fullwidth is-hoverable">
      <thead>
        <tr>
          <th>Número</th>
          <th>Fornecedor</th>
          <th>Status</th>
          <th>Valor total</th>
          <th>Previsão</th>
          <th>Criado em</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.order_number }}</td>
          <td>{{ order.supplier }}</td>
          <td><span class="chip">{{ order.get_status_display }}</span></td>
          <td>R$ {{ order.total_amount|floatformat:2 }}</td>
          <td>{% if order.expected_date %}{{ order.expected_date|date:"d/m/Y" }}{% else %}—{% endif %}</td>
          <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Nenhum pedido de compra cadastrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
